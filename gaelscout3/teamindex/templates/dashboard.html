<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Team Index</title>
    <script type="text/javascript">
      oprs = {{ js_oprs }};
      ranks = {{ js_ranks }};
      mscores = {{ js_mscores }};
    </script>

  </head>
  <body>
    <a href="{% url 'home'%}">Home</a>
    <a href="{% url 'teamindex'%}">Team Index</a>
    <a href="{% url 'divisionindex'%}">Division Index</a>
    <a href="{% url 'matches'%}">Matches</a>

    <h2>{{team.name}}</h2>
    {% if research%}
    <p>W-L Prediction: {{research.w}}â€”{{research.l}}</p>
    {% endif %}
    <p>Average OPR: {{team.avg_opr}}</p>
    <p>OPR Percentile: {{team.opr_percentile}}%</p>
    <p>Average max score: {{team.avg_mscore}}</p>
    <p>Max score percentile: {{team.mscore_percentile}}%</p>


    {% if matches %}
    <h3>Match Schedule</h3>
    <table>
        <tr>
            <th>Match Number</th>
            <th>Field</th>
            <th>Day</th>
            <th>Time</th>
            <th>Red 1</th>
            <th>Red 1 OPR</th>
            <th>Red 1 Max Score</th>
            <th>Red 2</th>
            <th>Red 2 OPR</th>
            <th>Red 2 Max Score</th>
            <th>Blue 1</th>
            <th>Blue 1 OPR</th>
            <th>Blue 1 Max Score</th>
            <th>Blue 2</th>
            <th>Blue 2 OPR</th>
            <th>Blue 2 Max Score</th>
            <th>Chance</th>
        </tr>
        {% for m in matches %}
        {% for match in m %}
        <tr >
                <td><a href="{% url 'specmatch' match.number %}">{{ match.number }}</a></td>
            <td>{{ match.field }}</td>
            <td>{{ match.day }}</td>
            <td>{{ match.time }} {{ match.phase }}</td>
            <td {% if  match.red1 == team.name and match.winner == "R" %} style="background-color: #00EA57" {% elif match.red1 == team.name and match.winner == "B" %} style="background-color: red"{% endif %}><a href="{% url 'dashboard' match.red1 %}">{{ match.red1 }}</a></td>
            <td {% if  match.red1 == team.name and match.winner == "R" %} style="background-color: #00EA57" {% elif match.red1 == team.name and match.winner == "B" %} style="background-color: red"{% endif %}>{{ match.red1_opr }}</td>
            <td {% if  match.red1 == team.name and match.winner == "R" %} style="background-color: #00EA57" {% elif match.red1 == team.name and match.winner == "B" %} style="background-color: red"{% endif %}>{{ match.red1_mscore }}</td>
            <td {% if  match.red2 == team.name and match.winner == "R" %} style="background-color: #00EA57" {% elif match.red2 == team.name and match.winner == "B" %} style="background-color: red"{% endif %}><a href="{% url 'dashboard' match.red2 %}">{{ match.red2 }}</a></td>
            <td {% if  match.red2 == team.name and match.winner == "R" %} style="background-color: #00EA57" {% elif match.red2 == team.name and match.winner == "B" %} style="background-color: red"{% endif %}>{{ match.red2_opr }}</td>
            <td {% if  match.red2 == team.name and match.winner == "R" %} style="background-color: #00EA57" {% elif match.red2 == team.name and match.winner == "B" %} style="background-color: red"{% endif %}>{{ match.red2_mscore }}</td>
            <td {% if  match.blue1 == team.name and match.winner == "B" %} style="background-color: #00EA57" {% elif match.blue1 == team.name and match.winner == "R" %} style="background-color: red"{% endif %}><a href="{% url 'dashboard' match.blue1 %}">{{ match.blue1 }}</a></td>
            <td {% if  match.blue1 == team.name and match.winner == "B" %} style="background-color: #00EA57" {% elif match.blue1 == team.name and match.winner == "R" %} style="background-color: red"{% endif %}>{{ match.blue1_opr }}</td>
            <td {% if  match.blue1 == team.name and match.winner == "B" %} style="background-color: #00EA57" {% elif match.blue1 == team.name and match.winner == "R" %} style="background-color: red"{% endif %}>{{ match.blue1_mscore }}</td>
            <td {% if  match.blue2 == team.name and match.winner == "B" %} style="background-color: #00EA57" {% elif match.blue2 == team.name and match.winner == "R" %} style="background-color: red"{% endif %}><a href="{% url 'dashboard' match.blue2 %}">{{ match.blue2 }}</a></td>
            <td {% if  match.blue2 == team.name and match.winner == "B" %} style="background-color: #00EA57" {% elif match.blue2 == team.name and match.winner == "R" %} style="background-color: red"{% endif %}>{{ match.blue2_opr }}</td>
            <td{% if  match.blue2 == team.name and match.winner == "B" %} style="background-color: #00EA57" {% elif match.blue2 == team.name and match.winner == "R" %} style="background-color: red"{% endif %}>{{ match.blue2_mscore }}</td>
            <td {% if match.winner == "B" %} style="background-color: blue" {% elif match.winner == "R" %} style="background-color: red"{% endif %}>{{ match.chance }}%</td>
        </tr>
            {% endfor %}
            {% endfor %}
    </table>
    {% endif %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js" charset="utf-8"></script>
    <div width="50px" height="20px">
        <canvas id="oprBar" width="300" height="300"></canvas>
    </div>
    <script type="text/javascript">
        oprs = {{ js_oprs }};
        ranks = {{ js_ranks }};
        mscores = {{ js_mscores }};
        function randomColor(data){
            var barArray = [];
            var borderArray = [];
            var rgbaBeginning = 'rgba(';
            var rgbaBarEnd = ', 0.4)';
            var rgbaBorderEnd = ', 1)';
            for(var i = 0; i < data.length; i++) {
                var totalColor = "";
                var color1 = Math.round(Math.random() * 255);
                var color2 = Math.round(Math.random() * 255);
                var color3 = Math.round(Math.random() * 255);
                totalBarColor = rgbaBeginning + color1 + ', ' + color2 + ', ' + color3 + rgbaBarEnd;
                totalBorderColor = rgbaBeginning + color1 + ', ' + color2 + ', ' + color3 + rgbaBorderEnd;
                barArray.push(totalBarColor);
                borderArray.push(totalBorderColor);
            }
            var colorArray = [barArray, borderArray];
            return colorArray
        }
        function dataIndex(data){
            var stringDataList = [];
            for(var i = 0; i < data.length; i++) {
                stringifiedData = i.toString();
                stringDataList.push(stringifiedData);
            }
            return stringDataList;
        }
        var oprMax = Math.max(...oprs) + 10;
        var oprMin = Math.min(...oprs) - 10;
        console.log(oprMin);
        console.log(oprMax);
        var oprColors = randomColor(oprs);
        var oprBorders = oprColors[1];
        var oprBars = oprColors[0];
        var oprDataList = dataIndex(oprs);
        console.log(oprBars);
        console.log(oprBorders);
        console.log(oprDataList);
        var ctx_opr_bar = document.getElementById("oprBar").getContext("2d");
        var oprBar = new Chart(ctx_opr_bar, {
        type: 'bar',
        barPercentage: 1,
        categoryPercentage: 1,
        data: {
            labels: oprDataList,
            datasets: [{
                label: 'OPR',
                data: oprs,
                backgroundColor: oprBars,
                borderColor: oprBorders,
                borderWidth: 1
            }]
        },
        options: {
            title: {
                display: true,
                position: "top",
                fontSize: 36,
                fontStyle: "bold",
                text: "OPR"
            },

            layout: {
                padding: {
                    left: 100,
                    right: 100,
                    top: 400,
                    bottom: 400
                }
            },
            scales: {
                scaleLabel: {
                    scaleTitle: "OPR",
                },
                yAxes: [{
                    ticks: {
                        beginAtZero:true,
                        max: oprMax,
                        min: oprMin,
                        steps: 10,
                        stepValue: 5
                    }
                }]
            }
        }
    });
    </script>

  </body>

</html>
